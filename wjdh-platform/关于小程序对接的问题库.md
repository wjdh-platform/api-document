<!-- TOC -->

- [问题库](#问题库)
  - [1说明](#1说明)
  - [2鉴权问题](#2鉴权问题)
    - [2.1 token的持续规则](#21-token的持续规则)
      - [2.1.1 token的存在时间是多久](#211-token的存在时间是多久)
      - [2.2.1小程序对token的处理流程是什么样子的](#221小程序对token的处理流程是什么样子的)
      - [2.3.1鉴权为什么做这么复杂](#231鉴权为什么做这么复杂)
      - [2.4.1为什么会节省时间和服务器开销？直接让后台判断token是否过期的方案不是更好吗](#241为什么会节省时间和服务器开销直接让后台判断token是否过期的方案不是更好吗)

<!-- /TOC -->
# 问题库

## 1说明

> 问题库的设立，是为了节省工作人员之间的时间，任何问题可以先在问题库里面寻找答案，如果找不到，再去问相关负责人。

## 2鉴权问题

### 2.1 token的持续规则

#### 2.1.1 token的存在时间是多久

>1、每一个token，有一个过期时间和一个无法刷新时间。

>2、过期时间为60分钟，无法刷新时间为14天。


>3、携带已过期的token，在14天内调用刷新接口tc.mg.cool//api/v1/authorizations/current，会重置过期时间和刷新时间。

>4、14天刷新时间结束后，需要再次用微信code码调用tc.mg.cool/api/v1/weapp/authorizations获得新的token值。

#### 2.2.1小程序对token的处理流程是什么样子的

>1、用户进入小程序，查看token值的过期时间，过期时间未超过1小时，不需要生成token或刷新token；

>2、用户进入小程序，发现token值已经超过过期时间，用旧token调用新token。

>3、（14天内未进入小程序）用户进入小程序，发现token值已经超过过期时间，用旧token调用新token，失败，用微信code申请token值。

#### 2.3.1鉴权为什么做这么复杂

>1、token存在的时间越短越好，一旦黑客截获token，1小时内token就会失效，来不及进一步盗取数据；

>2、token值14天内刷新机制，比使用code值调取新token，节省了1/3的时间和服务器开销；

#### 2.4.1为什么会节省时间和服务器开销？直接让后台判断token是否过期的方案不是更好吗

>下面描述后台判断token是否过期的方案：

>第一次发送请求，携带旧token，服务器得到旧token，不认，返回错误值code=1

>小程序根据code=1，去调用刷新token接口，服务器收到刷新指令，返回新token

>小程序拿着新token，去调取第一次发送请求的接口，服务器得到新token，认同，返回请求数据

>小程序：第一次调数据， 第二次调刷新，第三次再调数据 = 3

>服务器：第一次返回错误，第二次返回新token，第三次返回数据 = 3

>总共是6次握手

>下面描述前端判断token是否过期的方案

>17:11分获得新token，过期时间是18:11分

>发送请求数据之前，根据过期时间18:11来判断是否过期，如过期（如18：12），调用刷新接口，服务器收到刷新指令，返回新token

>小程序获得新token，拿着新token请求数据，服务器得到新token，认同，返回请求数据

>小程序： 第一次调刷新，第二次请求数据 =2

>服务器：第一次返回刷新token，第二次返回请求数据=2

>总共是4次握手

>后者比前者节省了两次网络通讯
