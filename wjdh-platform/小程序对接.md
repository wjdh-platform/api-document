# 小程序接口文档

## 接口编纂者

### 1-yangzhe杨哲(tonyhappystyle@163.com)

# 前言：各种一标三实数据对应号码

- 居民角色：
  
编号|名称|补充
|:--|:--|:--
0|家属|为防止物业端搞不清楚亲属的具体身份而设置，一般情况下不建议填写0
1|本人|业主本人
2|租客|所有非业主亲属的都是租客（包括租客的家人）
3|丈夫|
4|妻子|
5|父亲|
6|母亲|
7|爷爷|
8|奶奶|
9|姥爷|
10|姥姥|
11|儿子|
12|女儿|
13|其他|连是不是亲属、是不是租客都搞不清楚，那只能选其他了

- 房屋用途:
  
编号|名称|补充
|:--|:--|:--
1|住宅|
2|生产|
3|经营（商业）（饭店）|
4|仓储|
5|教育（医疗、卫生、科研）|
6|文化(娱乐、体育)|
7|办公|
8|商业（金融）（信息）|
9|其他|

- 房屋性质:
  
编号|名称|补充
|:--|:--|:--
1|私有|
2|公有|
3|其他|

- 居住现状:
  
编号|名称|补充
|:--|:--|:--
1|自用|
2|闲置|
3|借用|
4|空挂|
5|租用|
6|拆迁|
7|其他|

- 住户类型:
  
编号|名称|补充
|:--|:--|:--
1|业主|
2|租户|
3|其他|

- 小程序用户

编号|名称|补充
|:--|:--|:--
NewMember|小程序用户（未激活一标三实）|
HouseMember|小程序用户（已激活一标三实）|

## 1手机验证码

### 1.1获取手机验证码

>说明:发送手机号和申请类型获得验证码

>请求方法：POST

>url地址：<https://tc.mg.cool/api/v1/verificationCodes/phone>

#### 1.1.1携带数据

字段|格式|名称|补充
|:--|:--|:--|:--
phone|integer|手机号
type|string|验证码类型|见附录

#### 1.1.2返回数据

字段|格式|是否必填|名称|补充
|:--|:--|:--|:--|:--
code|integer|必填|处理结果|0成功，1出错
msg|string|必填|描述返回结果|
key|string|必填|验证码缓存键值（在其他接口中使用）
expired_at|string|必填|过期时间，默认5分钟

#### 1.1.3结果示例

``` json
1.成功，返回验证码缓存键值，并且后台发送验证码
{
    "code": "0",
    "msg": "验证码获取成功,5分钟内有效",
    "key": "verificationCode_qaFUTv8034G29I5",
    "expired_at": "2020-11-19 13:34:38"
}

```

```  json
2.失败，参数不正确
{
    "code": "1",
    "msg": "服务器开小差，请重试",
    "phone": "1761049113",
    "message": "必须是正确的手机号"
}
{
    "code": "1",
    "msg": "服务器开小差，请重试",
    "phone": "17610491130",
    "message": "type参数必须是login、register、verify等"
}
```

``` json
3.失败，register类型下，手机号已注册
{
    "code": "1",
    "msg": "该手机号已注册，请直接登录",
    "phone": "17610493577",
    "message": "手机号已存在"
}
```

``` json
4.失败，login类型下，手机号未注册
{
    "code": "1",
    "msg": "该手机号未注册",
    "phone": "18600381130",
    "message": "该手机号未注册"
}
```

#### 1.1.4接口附录

- type

字段|释义|补充
|:--|:--|:--
register|注册
login|登录
verify|验证|仅验证手机号是否可用
yezhu|业主|比其他验证码存留时间更长，默认30分钟

## 1.2注册

### 1.2.1手机号注册

>说明:该方法适用于之前从未拥有万家灯火平台帐号的用户

>请求方法：POST

>url地址：<https://tc.mg.cool/api/v1/weapp/users>

#### 1.2.1.1携带数据

字段|格式|是否必填|名称|补充
|:--|:--|:--|:--|:--
verification_key|string|必填|手机号验证码seesion缓存key值
verification_code|integer|必填|验证码
password|string|必填|密码
code|string|必填|微信用户code码
name|string|必填|微信用户昵称
avatar|string|必填|微信用户头像

#### 1.2.1.2返回数据

字段|格式|是否必填|名称|补充
|:--|:--|:--|:--|:--
code|integer|必填|处理结果|0成功，1出错
token_expired|integer|必填|是否过期|0过期，1未过期
msg|string|必填|描述返回结果|
access_token|string|必填|token值
expired_in|string|必填|过期时间，默认3600秒
roles|array|必填|角色，见前言
name|string|必填|用户微信昵称
avatar|string|必填|头像url

#### 1.2.1.3结果示例

``` json
1.成功，返回用户角色、token值、过期时间等用户
{
    "code": "0",
    "token_expired": "1",
    "msg": "保持登录状态",
    "access_token": "eyJ0eXAiO",
    "token_type": "Bearer",
    "expires_in": 3600,
    "roles": [
        "NewMember"
    ],
    "name": "yangzhe",
    "avatar": "avatar"
}

```

```  json
2.失败，参数不正确
{
    "code": "1",
    "msg": "服务器开小差，请重试",
    "message": "用户的name值未传送"
}
```

``` json
3.失败，验证码已失效
{
    "code": "1",
    "msg": "验证码已失效",
    "message": "验证码已失效"
}
```

## 1.3登录

### 1.3.1手机号验证码登录

>说明:登录的方法之一

>请求方法：POST

>url地址：<https://tc.mg.cool/api/v1/weapp/athorizations/phone>

#### 1.3.1.1携带数据

字段|格式|是否必填|名称|补充
|:--|:--|:--|:--|:--
verification_key|string|必填|手机号验证码seesion缓存key值
verification_code|integer|必填|验证码
password|string|必填|密码
code|string|必填|微信用户code码

#### 1.3.1.2返回数据

字段|格式|是否必填|名称|补充
|:--|:--|:--|:--|:--
code|integer|必填|处理结果|0成功，1出错
token_expired|integer|必填|是否过期|0过期，1未过期
msg|string|必填|描述返回结果|
access_token|string|必填|token值
expired_in|string|必填|过期时间，默认3600秒
roles|array|必填|角色，见前言
name|string|必填|用户微信昵称
avatar|string|必填|头像url

#### 1.3.1.3结果示例

``` json
1.成功，返回用户角色、token值、过期时间等用户
{
    "code": "0",
    "token_expired": "1",
    "msg": "token值等用户数据获取成功",
    "access_token": "eyJ0eXAiO",
    "token_type": "Bearer",
    "expires_in": 3600,
    "roles": [
        "NewMember"
    ],
    "name": "yangzhe",
    "avatar": "avatar"
}

```

```  json
2.失败，参数不正确
{
    "code": "1",
    "msg": "服务器开小差，请重试",
    "message": "小程序code不正确，请传递新code值"
}
```

``` json
3.失败，验证码已失效
{
    "code": "1",
    "msg": "验证码已失效",
    "message": "验证码已失效"
}
```

### 1.4.1帐号密码登录

>说明:登录的方法之一

>请求方法：POST

>url地址：<https://tc.mg.cool/api/v1/weapp/authorizations>

#### 1.4.1.1携带数据

字段|格式|是否必填|名称|补充
|:--|:--|:--|:--|:--
username|string|必填|用户帐号
password|string|必填|密码
code|string|必填|微信用户code码

#### 1.4.1.2返回数据

字段|格式|是否必填|名称|补充
|:--|:--|:--|:--|:--
code|integer|必填|处理结果|0成功，1出错
token_expired|integer|必填|是否过期|0过期，1未过期
msg|string|必填|描述返回结果|
access_token|string|必填|token值
expired_in|string|必填|过期时间，默认3600秒
roles|array|必填|角色，见前言
name|string|必填|用户微信昵称
avatar|string|必填|头像url

#### 1.4.1.3结果示例

``` json
1.成功，返回用户角色、token值、过期时间等用户
{
    "code": "0",
    "token_expired": "1",
    "msg": "token值等用户数据获取成功",
    "access_token": "eyJ0eXAiO",
    "token_type": "Bearer",
    "expires_in": 3600,
    "roles": [
        "NewMember"
    ],
    "name": "yangzhe",
    "avatar": "avatar"
}

```

```  json
2.失败，参数不正确
{
    "code": "1",
    "msg": "服务器开小差，请重试",
    "message": "小程序code不正确，请传递新code值"
}
```

``` json
3.失败，验证码已失效
{
    "code": "1",
    "msg": "验证码已失效",
    "message": "验证码已失效"
}
```

### 1.2.1获取token
>说明:通过人工添加鉴权键值对，携带键值对访问该接口，返回token

>请求方法：POST

>url:https://tc.mg.cool/api/v1/wjdh/secret

### 携带数据：
字段|释义|是否必填|携带方式|举例（测试）
|:--|:--|:--|:--|:--
secret_id|键|必填|form-data|123456
secret_key|键值|必填|form-data|123456
### 头部信息
键|值|
|:--|:--
Accept|application/json
### 返回数据
字段|释义|选项
|:--|:--|:--
code|报错值|0无报错1有报错
token_expired|token值是否失效|0失效1有效
msg|可弹出报错|获取到了token值
access_token|token值|eyJ0eXA…………
token_type|Bearer|Authorization的携带的token头（后面的接口有解释）
expires_in|过期时间|3600

### 1.2.2获取审核数据列表
>说明:获取审核数据的列表

>请求方法：POST

>URL:https://tc.mg.cool/api/v1/wjdh/secret

### 携带数据：
字段|释义|是否必填|携带方式|举例（测试）
|:--|:--|:--|:--|:--
type|审核（目的）类型|非必填|form-data|1业主绑定，2租客绑定，3家属绑定，4替换业主，5业主解绑，6租客解绑，7家属解绑，9业主修改房屋数据，10修改个人信息
community_id|安防平台社区表的id|必填|form-data|审核状态：0审核未通过；1审核通过；2等待审核中；3审核驳回
status|审核状态|非必填|form-data|审核状态：0审核未通过；1审核通过；2等待审核中；3审核驳回
page|页数|非必填|form-data|1
per_page|每页显示条数|非必填|默认20
### 头部信息
键|值|
|:--|:--
Accept|application/json
Authorization|Bearer eyJ0e……
### 返回数据
字段|释义|选项
|:--|:--|:--
type|报错值|0无报错1有报错
token_expired|token值是否失效|0失效1有效
msg|可弹出报错|获取到了token值
access_token|token值|eyJ0eXA…………
token_type|Bearer|Authorization的携带的token头（后面的接口有解释）
expires_in|过期时间|3600


查询该房间是否绑定业主，如果绑定返回业主手机号后四位

{
    "code": "0",
    "token_expired": "1",
    "msg": "已获取房屋业主手机号码",
    "data": {
        "people_phone": "17600381130",
        "people_house_use": "1",
        "people_house_xingzhi": "1",
        "people_house_status": "1",
        "people_house_role": "1",
        "people_house_type": "1",
        "phone": "176****1130"
    },
    "message": "获得了手机号码，还获得了该房屋的基本信息值，一旦业主提供的验证码核实通过，就展现给用户查看"
}

{
    "code": "1",
    "token_expired": "1",
    "msg": "未获得业主信息,是空房子，请继续录入",
    "message": "未获得业主信息，message编码Yi1051"
}