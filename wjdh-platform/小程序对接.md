<!-- TOC -->

- [小程序接口文档](#小程序接口文档)
  - [接口编纂者](#接口编纂者)
    - [1-yangzhe杨哲(tonyhappystyle@163.com)](#1-yangzhe杨哲tonyhappystyle163com)
- [前言：各种一标三实数据对应号码](#前言各种一标三实数据对应号码)
- [1授权](#1授权)
  - [1.1获取手机验证码](#11获取手机验证码)
    - [1.1.1携带数据](#111携带数据)
    - [1.1.2返回数据](#112返回数据)
    - [1.1.3结果示例](#113结果示例)
    - [1.1.4接口附录](#114接口附录)
  - [1.2注册](#12注册)
    - [1.2.1获取openid和seesion_key](#121获取openid和seesion_key)
      - [1.2.1.1携带数据](#1211携带数据)
      - [1.2.1.2返回数据](#1212返回数据)
      - [1.2.1.3结果示例](#1213结果示例)
    - [1.2.2手机号注册+登陆二合一](#122手机号注册登陆二合一)
      - [1.2.2.1携带数据](#1221携带数据)
      - [1.2.2.2返回数据](#1222返回数据)
      - [1.2.2.3结果示例](#1223结果示例)
  - [1.3登陆合并到了1.2.1](#13登陆合并到了121)
  - [1.4获取token](#14获取token)
    - [1.4.1发送code值到后台获取token](#141发送code值到后台获取token)
      - [1.4.1.1头部信息](#1411头部信息)
      - [1.4.1.2返回数据](#1412返回数据)
      - [1.4.1.3结果示例](#1413结果示例)
    - [1.4.2发送旧token值到后台获取新token](#142发送旧token值到后台获取新token)
      - [1.4.2.1头部信息](#1421头部信息)
      - [1.4.2.2返回数据](#1422返回数据)
      - [1.4.2.3结果示例](#1423结果示例)
  - [1.5获取角色](#15获取角色)
    - [1.5.1获取微信小程序用户的角色](#151获取微信小程序用户的角色)
      - [1.5.1.1头部信息](#1511头部信息)
      - [1.5.1.2返回数据](#1512返回数据)
      - [1.5.1.3结果示例](#1513结果示例)
- [2一标三实录入](#2一标三实录入)
  - [2.1获得基础数据](#21获得基础数据)
    - [2.1.1获得小区](#211获得小区)
      - [2.1.1.1头部信息](#2111头部信息)
      - [2.1.1.2返回数据](#2112返回数据)
      - [2.1.1.3结果示例](#2113结果示例)
      - [2.1.1.4接口附录](#2114接口附录)
    - [2.1.2获得楼栋](#212获得楼栋)
      - [2.1.2.1头部信息](#2121头部信息)
      - [2.1.2.2返回数据](#2122返回数据)
      - [2.1.2.3结果示例](#2123结果示例)
      - [2.1.2.4接口附录](#2124接口附录)
    - [2.1.3获得单元](#213获得单元)
      - [2.1.3.1头部信息](#2131头部信息)
      - [2.1.3.2返回数据](#2132返回数据)
      - [2.1.3.3结果示例](#2133结果示例)
      - [2.1.3.4接口附录](#2134接口附录)
    - [2.1.4获得楼层](#214获得楼层)
      - [2.1.4.1头部信息](#2141头部信息)
      - [2.1.4.2返回数据](#2142返回数据)
      - [2.1.4.3结果示例](#2143结果示例)
      - [2.1.4.4接口附录](#2144接口附录)
    - [2.1.5获得房屋](#215获得房屋)
      - [2.1.5.1头部信息](#2151头部信息)
      - [2.1.5.2返回数据](#2152返回数据)
      - [2.1.5.3结果示例](#2153结果示例)
      - [2.1.5.4接口附录](#2154接口附录)
  - [2.2查询安防数据库数据](#22查询安防数据库数据)
    - [2.2.1验证手机号是否已经绑定一标三实](#221验证手机号是否已经绑定一标三实)
      - [2.2.1.1头部信息](#2211头部信息)
      - [2.2.1.2携带数据](#2212携带数据)
      - [2.2.1.3返回数据](#2213返回数据)
      - [2.2.1.4结果示例](#2214结果示例)
    - [2.2.2查询某房间是否绑定业主，如果绑定返回业主信息](#222查询某房间是否绑定业主如果绑定返回业主信息)
      - [2.2.2.1头部信息](#2221头部信息)
      - [2.2.2.2携带数据](#2222携带数据)
      - [2.2.2.3返回数据](#2223返回数据)
      - [2.2.2.4结果示例](#2224结果示例)
    - [2.2.3校验业主手机号是否正确](#223校验业主手机号是否正确)
      - [2.2.3.1头部信息](#2231头部信息)
      - [2.2.3.2携带数据](#2232携带数据)
      - [2.2.3.3返回数据](#2233返回数据)
      - [2.2.3.4结果示例](#2234结果示例)
  - [2.3附件上传](#23附件上传)
    - [2.3.1人脸照片上传](#231人脸照片上传)
      - [2.3.1.1头部信息](#2311头部信息)
      - [2.3.1.2携带数据](#2312携带数据)
      - [2.3.1.3返回数据](#2313返回数据)
      - [2.3.1.4结果示例](#2314结果示例)
    - [2.3.2身份证验证](#232身份证验证)
      - [2.3.2.1头部信息](#2321头部信息)
      - [2.3.2.2携带数据](#2322携带数据)
      - [2.3.2.3返回数据](#2323返回数据)
      - [2.3.2.4结果示例](#2324结果示例)
  - [2.4表单提交](#24表单提交)
    - [2.4.1第一次录入一标三实表单](#241第一次录入一标三实表单)
      - [2.4.1.1头部信息](#2411头部信息)
      - [2.4.1.2携带数据](#2412携带数据)
      - [2.4.1.3返回数据](#2413返回数据)
      - [2.4.1.4结果示例](#2414结果示例)
      - [2.4.1.5附录](#2415附录)
  - [company|string|必填|用户上次填的公司](#companystring必填用户上次填的公司)
    - [2.4.2绑定更多房屋](#242绑定更多房屋)
      - [2.4.2.1头部信息](#2421头部信息)
      - [2.4.2.2携带数据](#2422携带数据)
      - [2.4.2.3返回数据](#2423返回数据)
      - [2.4.2.4结果示例](#2424结果示例)
- [3列表页面](#3列表页面)
  - [3.1用户相关数据列表](#31用户相关数据列表)
    - [3.1.1绑定房屋列表](#311绑定房屋列表)
      - [3.1.1.1头部信息](#3111头部信息)
      - [3.1.1.2返回数据](#3112返回数据)
      - [3.1.1.3结果示例](#3113结果示例)
    - [3.1.2房屋详情页](#312房屋详情页)
      - [3.1.2.1头部信息](#3121头部信息)
      - [3.1.2.2携带数据](#3122携带数据)
      - [3.1.2.3返回数据](#3123返回数据)
      - [3.1.2.4结果示例](#3124结果示例)
    - [3.1.3审核详情页](#313审核详情页)
      - [3.1.3.1头部信息](#3131头部信息)
      - [3.1.3.2携带数据](#3132携带数据)
      - [3.1.3.3返回数据](#3133返回数据)
      - [3.1.3.4结果示例](#3134结果示例)
    - [3.1.4删除审核](#314删除审核)
      - [3.1.4.1头部信息](#3141头部信息)
      - [3.1.4.2携带数据](#3142携带数据)
      - [3.1.4.3返回数据](#3143返回数据)
      - [3.1.4.4结果示例](#3144结果示例)
  - [3.2用户授权](#32用户授权)
    - [3.2.1业主授权/禁用家庭成员管理](#321业主授权禁用家庭成员管理)
      - [3.2.1.1头部信息](#3211头部信息)
      - [3.2.1.2携带数据](#3212携带数据)
      - [3.2.1.3返回数据](#3213返回数据)
      - [3.2.1.4结果示例](#3214结果示例)
    - [3.2.2解绑](#322解绑)
      - [3.2.2.1头部信息](#3221头部信息)
      - [3.2.2.2携带数据](#3222携带数据)
      - [3.2.2.3返回数据](#3223返回数据)
      - [3.2.2.4结果示例](#3224结果示例)
    - [3.2.3业主授权/禁用家庭成员支付](#323业主授权禁用家庭成员支付)
      - [3.2.3.1头部信息](#3231头部信息)
      - [3.2.3.2携带数据](#3232携带数据)
      - [3.2.3.3返回数据](#3233返回数据)
      - [3.2.3.4结果示例](#3234结果示例)
- [4订单支付](#4订单支付)
  - [4.1列表](#41列表)
    - [4.1.1订单列表](#411订单列表)
      - [4.1.1.1头部信息](#4111头部信息)
      - [4.1.1.2携带数据](#4112携带数据)
      - [4.1.1.2返回数据](#4112返回数据)
      - [4.1.1.3结果示例](#4113结果示例)
    - [4.1.2账单列表](#412账单列表)
      - [4.1.2.1头部信息](#4121头部信息)
      - [4.1.2.2携带数据](#4122携带数据)
      - [4.1.2.2返回数据](#4122返回数据)
      - [4.1.2.3结果示例](#4123结果示例)
  - [4.2支付](#42支付)
    - [4.2.1支付接口](#421支付接口)
      - [4.2.1.1头部信息](#4211头部信息)
      - [4.2.1.2携带数据](#4212携带数据)
      - [4.3.1.2返回数据](#4312返回数据)
      - [4.2.1.3结果示例](#4213结果示例)

<!-- /TOC -->
# 小程序接口文档

## 接口编纂者

### 1-yangzhe杨哲(tonyhappystyle@163.com)

---

# 前言：各种一标三实数据对应号码

- <span id="people_house_roles">居民角色</span>：
  
（取消编号，统一改为中文字符串）
名称|补充
|:--|:--
家属|为防止物业端搞不清楚亲属的具体身份而设置
业主|业主本人
租客|所有非业主亲属的都是租客（包括租客的家人）
丈夫|
妻子|
父亲|
母亲|
爷爷|
奶奶|
姥爷|
姥姥|
儿子|
女儿|
其他|连是不是亲属、是不是租客都搞不清楚，那只能选其他了

- <span id="people_house_use">房屋用途</span>:
  
名称|补充
|:--|:--
住宅|
生产|
经营|（商业）（饭店）
仓储|
教育|（医疗、卫生、科研）
文化|(娱乐、体育)
办公|
商业|（金融）（信息）
其他|

- <span id="house_type">房屋类型</span>

名称|补充
|:--|:--
单元楼|
筒子楼|
四合院|
独立平房|
自建小楼|
别墅|
自建|
其他|

- <span id="people_house_xingzhi">房屋性质</span>:
  
名称|补充
|:--|:--
私有|
公有|
其他|

- <span id="people_house_status">房屋状态</span>:
  
名称|补充
|:--|:--
自用|
闲置|
借用|
空挂|
租用|
拆迁|
其他|

- <span id="people_house_type">住户类型</span>:
  
|名称|补充
|:--|:--
业主|
租户|
其他|

- 审核类型
  
名称|补充
|:--|:--
业主绑定|11月18日已开发
租客绑定|11月18日已开发
家属绑定|11月18日已开发
替换业主|11月18日已开发
业主解绑|11月18日未开发解绑功能
租客解绑|11月18日未开发解绑功能
家属解绑|11月18日未开发解绑功能
修改房屋数据|11月18日未开发修改功能
修改个人信息|11月18日未开发修改功能

- <span id="shenhe_status">审核状态</span>
  
编码|名称|补充
|:--|:--|:--
0|审核未通过|
1|审核通过|
2|等待审核|

- <span id="user_permissions">小程序用户权限</sapn>

编号|名称|补充
|:--|:--|:--
NewMember|小程序用户（未激活一标三实）|
HouseMember|小程序用户（已激活一标三实）|
Shenheing|第一次提交审核且待审核的小程序用户

# 1授权

## 1.1获取手机验证码

>说明:发送手机号和申请类型获得验证码

>请求方法：POST

>url地址：<https://tc.mg.cool/api/v1/verificationCodes/phone>

### 1.1.1携带数据

字段|格式|是否必填|名称|补充
|:--|:--|:--|:--|:--
phone|integer|必填|手机号
type|string|必填|验证码类型|见附录
community_house_name|string|非必填|小区+楼栋+单元+楼层+房屋的名称|type="yezhu"时传送

### 1.1.2返回数据

字段|格式|是否必填|名称|补充
|:--|:--|:--|:--|:--
code|integer|必填|处理结果|0成功，1出错
msg|string|必填|描述返回结果|
key|string|必填|验证码缓存键值（在其他接口中使用）
expired_at|string|必填|过期时间，默认5分钟

### 1.1.3结果示例

``` json
1.成功，返回验证码缓存键值，并且后台发送验证码
{
    "code": "0",
    "msg": "验证码获取成功,5分钟内有效",
    "key": "verificationCode_qaFUTv8034G29I5",
    "expired_at": "2020-11-19 13:34:38"
}

```

```  json
2.失败，参数不正确
{
    "code": "1",
    "msg": "服务器开小差，请重试",
    "phone": "1761049113",
    "message": "必须是正确的手机号"
}
{
    "code": "1",
    "msg": "服务器开小差，请重试",
    "phone": "17610491130",
    "message": "type参数必须是login、register、verify等"
}
```

``` json
3.失败，register类型下，手机号已注册
{
    "code": "1",
    "msg": "该手机号已注册，请直接登录",
    "phone": "17610493577",
    "message": "手机号已存在"
}
```

``` json
4.失败，login类型下，手机号未注册
{
    "code": "1",
    "msg": "该手机号未注册",
    "phone": "18600381130",
    "message": "该手机号未注册"
}
```

### 1.1.4接口附录

- type

字段|释义|补充
|:--|:--|:--
register|注册
login|登录
verify|验证|仅验证手机号是否可用
yezhu|业主|比其他验证码存留时间更长，默认30分钟

---
---
---

## 1.2注册

### 1.2.1获取openid和seesion_key

>说明:通过code获得openid和seesion_key

>请求方法：POST

>url地址：<https://tc.mg.cool/api/v1/weapp/code>

#### 1.2.1.1携带数据

字段|格式|是否必填|名称|补充
|:--|:--|:--|:--|:--
code|string|必填|微信用户code码

#### 1.2.1.2返回数据

字段|格式|是否必填|名称|补充
|:--|:--|:--|:--|:--
code|integer|必填|处理结果|0成功，1出错
openid|string|必填|用来校验用户身份|
msg|string|必填|描述返回结果|
session_key|string|必填|用来解密注册时使用的加密字符串
message|string|必填|描述返回结果|

#### 1.2.1.3结果示例

``` json
1.成功，获取oepnid和session_key
{
    "code": "0",
    "msg": "获得open_id和seesion_key",
    "openid": "oRNfs4txH2QmXzewt234oyNdsa-n3HYI",
    "session_key": "gF3i6PSBHFMu2XqrY9XyPQ==",
    "message": "成功获取open_id和seesion_key"
}

```

### 1.2.2手机号注册+登陆二合一

>说明:该方法适用于之前从未拥有万家灯火平台帐号的用户

>请求方法：POST

>url地址：<https://tc.mg.cool/api/v1/weapp/users>

#### 1.2.2.1携带数据

字段|格式|是否必填|名称|补充
|:--|:--|:--|:--|:--
type|string|必填|注册类型|"weixin"是通过微信捆绑的手机号码注册用户，"selfPhone"是用户使用其他手机号进行注册和登陆
encryptedData|string|选填|type="weixin"时必须传值
iv|string|选填|type="weixin"时必须传值
verification_key|string|选填|手机号验证码seesion缓存key值
verification_code|integer|选填|验证码
openid|string|必填|
session_key|string|必填|
name|string|必填|微信用户昵称
avatar|string|必填|微信用户头像

#### 1.2.2.2返回数据

字段|格式|是否必填|名称|补充
|:--|:--|:--|:--|:--
code|integer|必填|处理结果|0成功，1出错
token_expired|integer|必填|是否过期|0过期，1未过期
msg|string|必填|描述返回结果|
access_token|string|必填|token值
expired_in|string|必填|过期时间，默认3600秒
permissions|array|必填|[小程序用户权限](#user_permissions)
name|string|必填|用户微信昵称
avatar|string|必填|头像url

#### 1.2.2.3结果示例

``` json
1.成功，用户有帐号，直接登陆
{
    "code": "0",
    "token_expired": "1",
    "msg": "您登陆成功！",
    "access_token": "eyJ0eXAiO",
    "token_type": "Bearer",
    "expires_in": 3600,
    "permissions": [
        "NewMember"
    ],
    "name": "yangzhe",
    "avatar": "avatar"
}
成功，用户没帐号，我们给他注册，并帮他登陆
{
    "code": "0",
    "token_expired": "1",
    "msg": "您注册成功！",
    "access_token": "eyJ0eXAiO",
    "token_type": "Bearer",
    "expires_in": 3600,
    "permissions": [
        "NewMember"
    ],
    "name": "yangzhe",
    "avatar": "avatar"
}
```

```  json
2.失败，参数不正确
{
    "code": "1",
    "msg": "服务器开小差，请重试",
    "message": "用户的name值未传送"
}
```

``` json
3.失败，验证码已失效
{
    "code": "1",
    "msg": "验证码已失效",
    "message": "验证码已失效"
}
```

---
---
---

## [1.3登陆合并到了1.2.1](#121手机号注册登陆二合一)

---
---
---

## 1.4获取token

### 1.4.1发送code值到后台获取token

>说明:在以下情景里面会使用到该接口

情景|目的|返回情况|补充
|:--|:--|:--|:--
注册用户无缓存状态进入小程序|查找该微信用户是否已注册|返回用户注册数据|详见下方返回示例
未注册用户无缓存状态进入小程序|查找该微信用户是否已注册|提示未注册|详见下方返回示例

>请求方法：POST

>url地址：<https://tc.mg.cool/api/v1/weapp/authorizations>

#### 1.4.1.1头部信息

> Authorization: Bearer token值

#### 1.4.1.2返回数据

字段|格式|是否必填|名称|补充
|:--|:--|:--|:--|:--
code|integer|必填|处理结果|0成功，1出错
token_expired|integer|必填|是否过期|0过期，1未过期
msg|string|必填|描述返回结果|
access_token|string|必填|token值
expired_in|string|必填|过期时间，默认3600秒
permissions|array|必填|[小程序用户权限](#user_permissions)
name|string|选填|用户微信昵称
avatar|string|选填|头像url

#### 1.4.1.3结果示例

``` json
1.成功，返回用户角色、token值、过期时间等用户
{
    "code": "0",
    "access_token": "eyJ0eXAiOi",
    "msg": "token值等用户数据获取成功",
    "token_type": "Bearer",
    "expires_in": 3600,
    "permissions": [
        "NewMember"
    ],
    "name": "yangzhe",
    "avatar": "avatar"
}

```

```  json
2.失败，参数不正确
{
    "code": "1",
    "msg": "服务器开小差，请重试",
    "message": "小程序code不正确，请传递新code值"
}
```

``` json
3.失败，该用户只是个游客，未注册
{
    "code": "1",
    "msg": "服务器开小差，请重试",
    "message": "这只是个游客"
}
```

---
---
---

### 1.4.2发送旧token值到后台获取新token

>说明:在以下情景里面会使用到该接口

情景|目的|返回情况|补充
|:--|:--|:--|:--
缓存中的token超过了过期时间|换取新token|返回新token和用户注册数据|详见“关于小程序对接的问题库”

>请求方法：PUT

>url地址：<https://tc.mg.cool/api/v1/authorizations/current>

#### 1.4.2.1头部信息

> Authorization: Bearer token值

#### 1.4.2.2返回数据

字段|格式|是否必填|名称|补充
|:--|:--|:--|:--|:--
code|integer|必填|处理结果|0成功，1出错
token_expired|integer|必填|是否过期|0过期，1未过期
msg|string|必填|描述返回结果|
access_token|string|必填|token值
expired_in|string|必填|过期时间，默认3600秒
permissions|array|必填|[小程序用户角色](#user_permissions)
name|string|必填|用户微信昵称
avatar|string|必填|头像url

#### 1.4.2.3结果示例

``` json
1.成功，返回用户角色、token值、过期时间等用户
{
    "code": "0",
    "access_token": "eyJ0eXAiOi",
    "msg": "token值等用户数据获取成功",
    "token_type": "Bearer",
    "expires_in": 3600,
    "permissions": [
        "NewMember"
    ],
    "name": "yangzhe",
    "avatar": "avatar",
}

```

```  json
2.失败，参数不正确
{
    "code": "1",
    "msg": "服务器开小差，请重试",
    "message": "小程序code不正确，请传递新code值"
}
```

``` json
3.失败，token值已经超过了14天更新时间，已经在后台缓存中移除，此时应该使用code换取token（详见本文档1.4.1）
{
    "code": "1",
    "msg": "服务器开小差，请重试",
    "message": "刷新token值失败,message编码Au335"
}
```

## 1.5获取角色

### 1.5.1获取微信小程序用户的角色

>说明:获取微信小程序用户的角色

>请求方法：POST

>url地址：<https://tc.mg.cool/api/v1/people/permissions>

#### 1.5.1.1头部信息

> Authorization: Bearer token值

#### 1.5.1.2返回数据

字段|格式|是否必填|名称|补充
|:--|:--|:--|:--|:--
code|integer|必填|处理结果|0成功，1出错
token_expired|integer|必填|是否过期|0过期，1未过期
msg|string|必填|描述返回结果|
data|array|必填|[小程序用户权限](#user_permissions)

#### 1.5.1.3结果示例

``` json
1.成功，返回用户角色
{
    "code": "0",
    "token_expired": "1",
    "msg": "获取用户角色成功",
    "data": [
        "HouseMember"
    ],
    "message": "获取用户角色成功message编码Yi2048"
}

```

``` json
2.失败，该用户只是个游客，未注册
{
    "code": "1",
    "msg": "服务器开小差，请重试",
    "message": "这只是个游客"
}
```

---
---
---

# 2一标三实录入

## 2.1获得基础数据

### 2.1.1获得小区

>说明:获得小区的数据列表

>请求方法：POST

>url地址：<https://tc.mg.cool/api/v1/communities>

#### 2.1.1.1头部信息

> 取消token值传递

#### 2.1.1.2返回数据

字段|格式|是否必填|名称|补充
|:--|:--|:--|:--|:--
code|integer|必填|处理结果|0成功，1出错
token_expired|integer|必填|token值是否过期|0过期，1未过期
msg|string|必填|描述返回结果|
message|string|必填|调试信息|
data|array|必填|见附录

#### 2.1.1.3结果示例

``` json
1.成功，返回小区列表数据
{
    "code": 0,
    "token_expired": "1",
    "msg": "获取到了小区",
    "message": "获取到了小区",
    "data": [
        {
            "id": 1,
            "city_id": null,
            "community_name": "晨曦家园",
            "community_identifier": "1",
            "community_pinyin": "ChenXiJiaYuan",
            "community_type": 0,
            "community_order": 0,
            "community_value1": null,
            "community_value2": null,
            "community_value3": null,
            "deleted_at": null
        },
        {
            "id": 2,
            "city_id": null,
            "community_name": "交运里",
            "community_identifier": "2",
            "community_pinyin": "JiaoYunLi",
            "community_type": 0,
            "community_order": 0,
            "community_value1": null,
            "community_value2": null,
            "community_value3": null,
            "deleted_at": null
        }
    ]
}

```

```  json
2.失败，未登录用户或token值超过1小时过期（理论上不应该出现token值过期的返回，因为过期时，应该先由小程序判断超过1小时过期，调取“刷新token”的接口，再携带新的token值（如果超过14天更新期限，则只能使用“code值获取token接口”重置token状态），来调取其他接口的数据。但实际当中，可能会出现意外情况，如还未到1小时，但服务器端缓存意外丢失，导致token值失效。）
{
    "code": "9",
    "token_expired": "0",
    "msg": "请重新建立智慧平台鉴权连接",
    "message": "token值因各种原因而失效，请重新调用接口获取token"
}
```

#### 2.1.1.4接口附录

- data

``` json
        {
            "id": 1,
            "city_id": null,
            "community_name": "晨曦家园",
            "community_identifier": "1",
            "community_pinyin": "ChenXiJiaYuan",
            "community_type": 0,
            "community_order": 0,
            "community_value1": null,
            "community_value2": null,
            "community_value3": null,
            "deleted_at": null
        }
```

字段|类型|释义|选项
|:--|:--|:--|:--
id|integer|社区表主键id|对本接口无用
city_id|integer|城市代码|对本接口无用
community_name|string|小区名称|
community_identifier|integer|社区唯一标识|作为调取楼栋时使用的id值传入
community_type|integer|小区类型|对本接口无用
community_order|integer|小区展示顺序|2020年11月20日由于小区数量过少，暂未涉及

---

### 2.1.2获得楼栋

>说明:获得某小区的楼栋数据列表

>请求方法：POST

>url地址：<https://tc.mg.cool/api/v1/buildings>

#### 2.1.2.1头部信息

> Authorization: Bearer token值

#### 2.1.2.2返回数据

字段|格式|是否必填|名称|补充
|:--|:--|:--|:--|:--
code|integer|必填|处理结果|0成功，1出错
token_expired|integer|必填|token值是否过期|0过期，1未过期
msg|string|必填|描述返回结果|
message|string|必填|调试信息|
data|array|必填|见附录

#### 2.1.2.3结果示例

``` json
1.成功，返回楼栋列表数据
{
    "code": 0,
    "token_expired": "1",
    "msg": "获取到了楼栋",
    "message": "获取到了楼栋",
    "data": [
        {
            "id": 1,
            "community_identifier": 1,
            "building_number": 1,
            "building_name": "1栋",
            "deleted_at": null
        },
        {
            "id": 2,
            "community_identifier": 1,
            "building_number": 10,
            "building_name": "10栋",
            "deleted_at": null
        },
    ]
}

```

```  json
2.失败，未登录用户或token值超过1小时过期（理论上不应该出现token值过期的返回，因为过期时，应该先由小程序判断超过1小时过期，调取“刷新token”的接口，再携带新的token值（如果超过14天更新期限，则只能使用“code值获取token接口”重置token状态），来调取其他接口的数据。但实际当中，可能会出现意外情况，如还未到1小时，但服务器端缓存意外丢失，导致token值失效。）
{
    "code": "9",
    "token_expired": "0",
    "msg": "请重新建立智慧平台鉴权连接",
    "message": "token值因各种原因而失效，请重新调用接口获取token"
}
```

#### 2.1.2.4接口附录

- data

``` json
    {
        "id": 1,
        "community_identifier": 1,
        "building_number": 1,
        "building_name": "1栋",
        "deleted_at": null
    }
```

字段|类型|释义|补充
|:--|:--|:--|:--
id|integer|楼栋表主键id|作为调取单元时使用的id值传入
building_name|string|楼栋名称|
building_number|integer|某社区下的楼栋唯一标识|对本接口无用
community_identifier|integer|社区唯一标识|对本接口无用
deleted_at|string|软删除时间|对本接口无用

---

### 2.1.3获得单元

>说明:获得某楼栋的单元数据列表

>请求方法：POST

>url地址：<https://tc.mg.cool/api/v1/units>

#### 2.1.3.1头部信息

> Authorization: Bearer token值

#### 2.1.3.2返回数据

字段|格式|是否必填|名称|补充
|:--|:--|:--|:--|:--
code|integer|必填|处理结果|0成功，1出错
token_expired|integer|必填|token值是否过期|0过期，1未过期
msg|string|必填|描述返回结果|
message|string|必填|调试信息|
data|array|必填|见附录

#### 2.1.3.3结果示例

``` json
1.成功，返回楼栋列表数据
{
    "code": 0,
    "token_expired": "1",
    "msg": "获取到了楼栋",
    "message": "获取到了楼栋",
    "data": [
        {
            "id": 1,
            "building_id": 1,
            "community_identifier": 1,
            "unit_number": 1,
            "unit_name": "1单元",
            "deleted_at": null
        },
        {
            "id": 2,
            "building_id": 1,
            "community_identifier": 1,
            "unit_number": 2,
            "unit_name": "2单元",
            "deleted_at": null
        },
    ]
}

```

```  json
2.失败，未登录用户或token值超过1小时过期（理论上不应该出现token值过期的返回，因为过期时，应该先由小程序判断超过1小时过期，调取“刷新token”的接口，再携带新的token值（如果超过14天更新期限，则只能使用“code值获取token接口”重置token状态），来调取其他接口的数据。但实际当中，可能会出现意外情况，如还未到1小时，但服务器端缓存意外丢失，导致token值失效。）
{
    "code": "9",
    "token_expired": "0",
    "msg": "请重新建立智慧平台鉴权连接",
    "message": "token值因各种原因而失效，请重新调用接口获取token"
}
```

#### 2.1.3.4接口附录

- data

``` json
    {
            "id": 1,
            "building_id": 1,
            "community_identifier": 1,
            "unit_number": 1,
            "unit_name": "1单元",
            "deleted_at": null
    }
```

字段|类型|释义|补充
|:--|:--|:--|:--
id|integer|楼栋表主键id|作为调取楼层时使用的id值传入
building_id|string|所属楼栋表id|对本接口无用
unit_number|integer|某楼栋下的单元唯一标识|对本接口无用
unit_name|string|单元名称|
community_identifier|integer|社区唯一标识|对本接口无用
deleted_at|string|软删除时间|对本接口无用

### 2.1.4获得楼层

>说明:获得某单元的楼层数据列表

>请求方法：POST

>url地址：<https://tc.mg.cool/api/v1/floors>

#### 2.1.4.1头部信息

> Authorization: Bearer token值

#### 2.1.4.2返回数据

字段|格式|是否必填|名称|补充
|:--|:--|:--|:--|:--
code|integer|必填|处理结果|0成功，1出错
token_expired|integer|必填|token值是否过期|0过期，1未过期
msg|string|必填|描述返回结果|
message|string|必填|调试信息|
data|array|必填|见附录

#### 2.1.4.3结果示例

``` json
1.成功，返回楼栋列表数据
{
    "code": 0,
    "token_expired": "1",
    "msg": "获取到了楼层",
    "message": "获取到了楼层",
    "data": [
            {
                "id": 1,
                "unit_id": 1,
                "community_identifier": 1,
                "floor_number": 1,
                "floor_name": "1楼",
                "deleted_at": null
            },
            {
                "id": 2,
                "unit_id": 1,
                "community_identifier": 1,
                "floor_number": 2,
                "floor_name": "2楼",
                "deleted_at": null
            }
        ]
}
```

```  json
2.失败，未登录用户或token值超过1小时过期（理论上不应该出现token值过期的返回，因为过期时，应该先由小程序判断超过1小时过期，调取“刷新token”的接口，再携带新的token值（如果超过14天更新期限，则只能使用“code值获取token接口”重置token状态），来调取其他接口的数据。但实际当中，可能会出现意外情况，如还未到1小时，但服务器端缓存意外丢失，导致token值失效。）
{
    "code": "9",
    "token_expired": "0",
    "msg": "请重新建立智慧平台鉴权连接",
    "message": "token值因各种原因而失效，请重新调用接口获取token"
}
```

#### 2.1.4.4接口附录

- data

``` json
    {
            "id": 1,
            "unit_id": 1,
            "community_identifier": 1,
            "floor_number": 1,
            "floor_name": "1楼",
            "deleted_at": null
    }
```

字段|类型|释义|补充
|:--|:--|:--|:--
id|integer|楼栋表主键id|作为调取房间时使用的id值传入
unit_id|string|所属单元表id|对本接口无用
floor_number|integer|某单元下的楼层唯一标识|对本接口无用
floor_name|string|单元名称|
community_identifier|integer|社区唯一标识|对本接口无用
deleted_at|string|软删除时间|对本接口无用

---

### 2.1.5获得房屋

>说明:获得某单元的楼层数据列表

>请求方法：POST

>url地址：<https://tc.mg.cool/api/v1/houses>

#### 2.1.5.1头部信息

> Authorization: Bearer token值

#### 2.1.5.2返回数据

字段|格式|是否必填|名称|补充
|:--|:--|:--|:--|:--
code|integer|必填|处理结果|0成功，1出错
token_expired|integer|必填|token值是否过期|0过期，1未过期
msg|string|必填|描述返回结果|
message|string|必填|调试信息|
data|array|必填|见附录

#### 2.1.5.3结果示例

``` json
1.成功，返回房屋列表数据
{
    "code": 0,
    "token_expired": "1",
    "msg": "获取到了房间和业主手机号",
    "message": "获取到了房间和业主手机号",
    "data": [
        {
            "id": 1,
            "floor_id": 1,
            "community_identifier": 1,
            "house_number": 101,
            "house_name": "101号",
            "house_type": "单元楼",
            "house_value1": null,
            "house_value2": null,
            "house_value3": null,
            "deleted_at": null
        },
        {
            "id": 2,
            "floor_id": 1,
            "community_identifier": 1,
            "house_number": 102,
            "house_name": "102号",
            "house_type": "单元楼",
            "house_value1": null,
            "house_value2": null,
            "house_value3": null,
            "deleted_at": null
        }
    ]
}
```

```  json
2.失败，未登录用户或token值超过1小时过期（理论上不应该出现token值过期的返回，因为过期时，应该先由小程序判断超过1小时过期，调取“刷新token”的接口，再携带新的token值（如果超过14天更新期限，则只能使用“code值获取token接口”重置token状态），来调取其他接口的数据。但实际当中，可能会出现意外情况，如还未到1小时，但服务器端缓存意外丢失，导致token值失效。）
{
    "code": "9",
    "token_expired": "0",
    "msg": "请重新建立智慧平台鉴权连接",
    "message": "token值因各种原因而失效，请重新调用接口获取token"
}
```

#### 2.1.5.4接口附录

- data

``` json
    {
            "id": 2,
            "floor_id": 1,
            "community_identifier": 1,
            "house_number": 102,
            "house_name": "102号",
            "house_type": "单元楼",
            "house_value1": null,
            "house_value2": null,
            "house_value3": null,
            "deleted_at": null
        }
```

字段|类型|释义|补充
|:--|:--|:--|:--
id|integer|房屋表主键id|作为调取房屋业主信息的id值传入
floor_id|integer|所属楼层表id|对本接口无用
house_number|integer|某楼层下的房屋唯一标识|对本接口无用
house_name|string|房屋名称|
house_type|string|房屋类型|见前言[房屋类型](#house_type)
community_identifier|integer|社区唯一标识|对本接口无用
deleted_at|string|软删除时间|对本接口无用

---
---
---

## 2.2查询安防数据库数据

### 2.2.1验证手机号是否已经绑定一标三实

>说明:该接口在用户第一次进入一标三实表单填写界面时，填写手机号+验证码后调用

>请求方法：POST

>url地址：<https://tc.mg.cool/api/v1/security/phone>

#### 2.2.1.1头部信息

> Authorization: Bearer token值

#### 2.2.1.2携带数据

字段|格式|是否必填|名称|补充
|:--|:--|:--|:--|:--
verification_key|string|必填|验证码的缓存key值|详见本文档的接口1.1
verification_code|integer|必填|验证码|
id|integer|必填|小区唯一标识编码|如晨熙家园的唯一编码是10002

#### 2.2.1.3返回数据

字段|格式|是否必填|名称|补充
|:--|:--|:--|:--|:--
code|integer|必填|处理结果|0成功，1出错
msg|string|必填|描述返回结果|
message|string|必填|调试信息|

#### 2.2.1.4结果示例

``` json
1.成功，将通过手机号查找到的安防平台数据保存到了万家灯火数据库，跳转到列表页。
{
    "code": 0,
    "msg": "已自动绑定您的一标三实信息",
    "message": "在安防平台查找到了数据"
}
```

``` json
2.成功，安防平台查找到了数据，但该用户已经录入个人信息，无需再再次录入个人信息,因此直接跳转到列表页（即people表中已经保存过，理论上不会出现该结果，因为后面我们将设计，在前端可以通过用户的HouseMember身份，来阻止用户使用该接口，即不会再弹出填写手机号的弹窗）
{
    "code": "0",
    "message":"保存到people数据库的操作出错，已经全部回滚，请和万家灯火技术人员核对问题所在（message编码Yi673）",
    "msg":"已绑定个人信息，无需二次录入",
    "token_expired":"1"
}
```

```  json
3.成功，但未查找到该房间的业主，可以让填表用户继续填写，流程正常运转
{
    "code": "2",
    "token_expired": "1",
    "msg": "该手机号还未绑定业主",
    "message": "安防平台没有查找到该手机号绑定的数据,message编码Yi658-message编码SeApi57"
}
```

```json
4.失败，安防平台接口出现故障
{
    "code": "1",
    "token_expired": "1",
    "msg": "系统开小差，请重试或联系工作人员",
    "message": "安防平台接口出现故障，请检查配置信息如安防平台url，message编码Yi652-message编码SeApi55"
}
```

```json
5.失败，万家灯火平台调取接口代码出现问题
{
    "code": "1",
    "token_expired": "1",
    "msg": "系统开小差，请重试或联系工作人员",
    "message": "万家灯火平台调用接口出现错误,message编码Yi664-message编码SeApi59"
}
```

```json
6.失败，验证码失效
{
    "code": "1",
    "token_expired": "1",
    "msg": "验证码已失效",
    "message": "验证码已失效"
}
```

---

### 2.2.2查询某房间是否绑定业主，如果绑定返回业主信息

>说明:该接口在填表人选择选择房屋后调用，如果返回数据，暂时保存在缓存中。只有当业主手机号验证通过后（见本文档2.2.3接口），才可以显示该接口返回的数据。

>请求方法：POST

>url地址：<https://tc.mg.cool/api/v1/security/yezhu>

#### 2.2.2.1头部信息

> Authorization: Bearer token值

#### 2.2.2.2携带数据

字段|格式|是否必填|名称|补充
|:--|:--|:--|:--|:--
id|integer|必填|房屋id|

#### 2.2.2.3返回数据

字段|格式|是否必填|名称|补充
|:--|:--|:--|:--|:--
code|integer|必填|处理结果|0成功，1出错
msg|string|必填|描述返回结果|
message|string|必填|调试信息|
data|array|必填|业主信息

#### 2.2.2.4结果示例

``` json
1.成功，返回该房屋业主信息
{
    "code": "0",
    "token_expired": "1",
    "msg": "已获取房屋业主手机号码",
    "data": {
        "people_phone": "17600381130",
        "people_house_use": "住宅",
        "people_house_xingzhi": "私有",
        "people_house_status": "自用",
        "people_house_role": "业主",
        "phone": "176****1130"
    },
    "message": "获得了手机号码，还获得了该房屋的基本信息值，一旦业主提供的验证码核实通过，就展现给用户查看"
}
```

```  json
2.成功，但未查找到该房间的业主，可以让填表用户继续填写
{
    "code": "2",
    "token_expired": "1",
    "msg": "该房屋尚未绑定业主",
    "message": "安防平台没有查找到该房屋下的业主数据,message编码Yi1149-message编码SeApi87"
}
```

```json
3.失败，安防平台接口出现故障
{
    "code": "1",
    "token_expired": "1",
    "msg": "系统开小差，请重试或联系工作人员",
    "message": "安防平台接口出现故障，请检查配置信息如安防平台url，message编码Yi652-message编码SeApi55"
}
```

```json
4.失败，万家灯火平台调取接口代码出现问题
{
    "code": "1",
    "token_expired": "1",
    "msg": "系统开小差，请重试或联系工作人员",
    "message": "万家灯火平台调用接口出现错误,message编码Yi664-message编码SeApi59"
}
```

```json
5.失败，token值超过1小时过期（理论上不应该出现token值过期的返回，因为过期时，应该先由小程序判断超过1小时过期，调取“刷新token”的接口，再携带新的token值（如果超过14天更新期限，则只能使用“code值获取token接口”重置token状态），来调取其他接口的数据。但实际当中，可能会出现意外情况，如还未到1小时，但服务器端缓存意外丢失，导致token值失效。）
{
    "code": "9",
    "token_expired": "0",
    "msg": "请重新建立智慧平台鉴权连接",
    "message": "token值因各种原因而失效，请重新调用接口获取token"
}
```

---

### 2.2.3校验业主手机号是否正确

>说明:该接口在填表人选择选择房屋后调用，如果返回数据，暂时保存在缓存中。只有当业主手机号验证通过后（见本文档2.2.3接口），才可以显示该接口返回的数据。

>请求方法：POST

>url地址：<https://tc.mg.cool/api/v1/security/yezhu-code>

#### 2.2.3.1头部信息

> Authorization: Bearer token值

#### 2.2.3.2携带数据

字段|格式|是否必填|名称|补充
|:--|:--|:--|:--|:--
verification_key|string|必填|验证码缓存键值|
verification_code|string|必填|验证码|

#### 2.2.3.3返回数据

字段|格式|是否必填|名称|补充
|:--|:--|:--|:--|:--
code|integer|必填|处理结果|0成功，1出错
msg|string|必填|描述返回结果|
message|string|必填|调试信息|
data|array|必填|业主信息

#### 2.2.3.4结果示例

``` json
1.成功
{
    "code": "0",
    "token_expired": "1",
    "msg": "验证成功",
    "message": "验证成功"
}
```

```  json
2.失败
{
    "code": "1",
    "token_expired": "1",
    "msg": "验证码错误",
    "message": "验证码错误"
}
```

```json
3.失败，token值超过1小时过期（理论上不应该出现token值过期的返回，因为过期时，应该先由小程序判断超过1小时过期，调取“刷新token”的接口，再携带新的token值（如果超过14天更新期限，则只能使用“code值获取token接口”重置token状态），来调取其他接口的数据。但实际当中，可能会出现意外情况，如还未到1小时，但服务器端缓存意外丢失，导致token值失效。）
{
    "code": "9",
    "token_expired": "0",
    "msg": "请重新建立智慧平台鉴权连接",
    "message": "token值因各种原因而失效，请重新调用接口获取token"
}
```

---
---
---

## 2.3附件上传

### 2.3.1人脸照片上传

>说明:该接口需要获得照片和绑定房屋的小区唯一标识、楼号、房屋号码等信息

>请求方法：POST

>url地址：<https://tc.mg.cool/api/v1/people/photo>

#### 2.3.1.1头部信息

> Authorization: Bearer token值

#### 2.3.1.2携带数据

``` javascript
    wx.uploadFile({
        filePath: res.tempFilePath,
        name: 'file',
        formData:{
            'community_identifier':_this.data.community_identifier,
            'building_number':_this.data.building_number,
            'unit_number':_this.data.unit_number,
            'floor_number':_this.data.floor_number,
            'house_number':_this.data.house_number
        },
        url: 'https://tc.mg.cool/api/v1/people/photo',
        success:function(message){
            console.log(JSON.parse(message.data))
        },
        fail:function(message){
            console.log(JSON.parse(message.data))
        }
    })
```

字段|格式|是否必填|名称|补充
|:--|:--|:--|:--|:--
file|string|必填|文件名称|
community_identifier|integer|必填|小区唯一标识|
building_number|integer|必填|楼号|
unit_number|integer|必填|单元号|
floor_number|integer|必填|楼层号|
house_number|integer|必填|房屋号|

#### 2.3.1.3返回数据

字段|格式|是否必填|名称|补充
|:--|:--|:--|:--|:--
code|integer|必填|处理结果|0成功，1出错
data|string|必填|照片OSS地址|
msg|string|必填|描述返回结果|
message|string|必填|调试信息|
token_expired|integer|必填|token值仍然未过期

#### 2.3.1.4结果示例

``` json
1.成功，返回图片url
{
    "code": "0",
    "data": "https://100k.mgg.cool/wjdh-platform/face-photo/1/2/3/4/401/202011/21/QhnV7ro72m5eYCTtdCNl6vLTusEigO7mNY7oVrVQ.png",
    "message": "图片上传成功,message编码Yi1320",
    "msg": "图片上传成功",
    "token_expired": "1"
}
```

```json
2.失败，参数不准确
{
    "code": "1",
    "token_expired": "1",
    "msg": "没有传递任何文件到后台",
    "message": "传递的file为空"
}
```

```json
5.失败，向OSS服务器上传失败
{
    "code": "1",
    "token_expired": "1",
    "msg": "图片上传失败",
    "message": "图片上传失败,message编码Yi1326"
}
```

---

### 2.3.2身份证验证

>说明:该接口上传身份证照片返回身份证相关信息

>请求方法：POST

>url地址：<https://tc.mg.cool/api/v1/idcard/photo>

#### 2.3.2.1头部信息

> Authorization: Bearer token值

#### 2.3.2.2携带数据

字段|格式|是否必填|名称|补充
|:--|:--|:--|:--|:--
image|string|必填|身份证的base64码|

#### 2.3.2.3返回数据

字段|格式|是否必填|名称|补充
|:--|:--|:--|:--|:--
code|integer|必填|处理结果|0成功，1出错
data|string|必填|身份证信息|
msg|string|必填|描述返回结果|
message|string|必填|调试信息|
token_expired|integer|必填|token值仍然未过期

#### 2.3.2.4结果示例

``` json
1.成功，返回身份证相关信息
{
    "code": "0",
    "token_expired": "1",
    "msg": "获取信息成功！",
    "data": {
        "birthday": "19921130",
        "address": "河北省秦皇岛市海港区秦皇小区98栋3单元4号",
        "gender": "男",
        "nation": "汉",
        "idcard": "130302199211302519",
        "name": "杨哲"
    },
    "message": "获取信息成功"
}
```

```json
2.失败，参数不准确
{
    "code": "1",
    "token_expired": "1",
    "msg": "没有传递image的base64码",
    "message": "传递的image字段为空"
}
```

```json
3.失败，照片扫描失败或者接口没充钱
{
    "code": "1",
    "token_expired": "1",
    "msg": "扫描失败，请重新上传更加清晰的照片或者手动填写个人信息",
    "message": "照片模糊，或者是接口欠费了"
}
```

---
---
---

## 2.4表单提交

### 2.4.1第一次录入一标三实表单

>说明:该表单将获取用户全部信息，包括个人信息、房屋信息

>请求方法：POST

>url地址：<https://tc.mg.cool/api/v1/weapp/yibiaosanshi>

#### 2.4.1.1头部信息

> Authorization: Bearer token值

#### 2.4.1.2携带数据

字段|格式|是否必填|名称|补充
|:--|:--|:--|:--|:--
phone|string|必填|手机号|
idcard|string|必填|身份证号|
name|string|必填|姓名|
photo|string|必填|人脸照片地址|
sex|string|必填|性别|男\女|扫描的有，手动填写的无
birth|integer|选填|出生日期|扫描的有，手动填写的无
nation|string|必填|民族|扫描的有，手动填写的无
address|string|必填|户籍地址|扫描的有，手动填写的无
zzmm|string|必填|政治面貌|群众\党员
tyjr|integer|必填|退役军人|0否1是
dibao|integer|必填|低保|0否1是
shangfang|integer|必填|上访记录|0否1是
job|string|必填|职业
company|string|必填|工作单位
house_id|integer|必填|房屋id|注意是id，而不是house_number
role|integer|选填|角色|详见前言[居民角色](#people_house_roles)
status|integer|选填|房屋状态|详见前言[房屋状态](#people_house_status)
use|integer|选填|房屋用途|详见前言[房屋用途](#people_house_status)
xingzhi|integer|选填|房屋性质|详见前言[房屋性质](#people_house_xingzhi)
choice|integer|选填|选择与业主绑定还是替换业主|1与业主绑定2替换业主
type|integer|选填|住户类型|详见前言[住户类型](#people_house_type)

#### 2.4.1.3返回数据

字段|格式|是否必填|名称|补充
|:--|:--|:--|:--|:--
code|integer|必填|处理结果|0成功，1出错
msg|string|必填|描述返回结果|
message|string|必填|调试信息|
token_expired|integer|必填|token值仍然未过期
shenhe_data|array|必填|用户常用的填表信息|见[2.4.1.5附录](#2415附录)

#### 2.4.1.4结果示例

``` json
1.成功，提交审核
{
    "code": "0",
    "message": "已提交审核",
    "msg": "已提交审核",
    "token_expired": "1",
}
```

```json
2.失败，参数不准确
{
    "code": "1",
    "token_expired": "1",
    "msg": "没有填写姓名",
    "message": "没有填写姓名"
}
```

#### 2.4.1.5附录

- data

字段|格式|是否必填|名称|补充
|:--|:--|:--|:--|:--
name|string|必填|用户上次填的姓名
idcard|string|必填|用户上次填的身份证号码
photo|string|必填|用户上次填的照片的url
phone|string|必填|用户上次填的手机号码
job|string|必填|用户上次填的工作
company|string|必填|用户上次填的公司
---

### 2.4.2绑定更多房屋

>说明:该表单一开始输入手机号，会判断该用户是否已经在people表中有数据，有数据则证明已经录入过一标三实数据，也就是说不必再录入个人信息，因此可以隐藏个人信息，并且在提交表单时，使用其他接口。

>请求方法：POST

>url地址：<2020年11月21日09:22:05未开发>

#### 2.4.2.1头部信息

> Authorization: Bearer token值

#### 2.4.2.2携带数据

字段|格式|是否必填|名称|补充
|:--|:--|:--|:--|:--
phone|string|必填|手机号|
house_id|integer|必填|房屋id|注意是id，而不是house_number
role|integer|选填|角色|详见前言[居民角色](#people_house_roles)
status|integer|选填|房屋状态|详见前言[房屋状态](#people_house_status)
use|integer|选填|房屋用途|详见前言[房屋用途](#people_house_status)
xingzhi|integer|选填|房屋性质|详见前言[房屋性质](#people_house_xingzhi)
choice|integer|选填|选择与业主绑定还是替换业主|1与业主绑定2替换业主
type|integer|选填|住户类型|详见前言[住户类型](#people_house_type)

#### 2.4.2.3返回数据

字段|格式|是否必填|名称|补充
|:--|:--|:--|:--|:--
code|integer|必填|处理结果|0成功，1出错
msg|string|必填|描述返回结果|
message|string|必填|调试信息|
token_expired|integer|必填|token值仍然未过期

#### 2.4.2.4结果示例

``` json
1.成功，提交审核
{
    "code": "0",
    "message": "已提交审核",
    "msg": "已提交审核",
    "token_expired": "1"
}

```

```json
2.失败，参数不准确
{
    "code": "1",
    "token_expired": "1",
    "msg": "没有填写姓名",
    "message": "没有填写姓名"
}
```

---
---
---

# 3列表页面

## 3.1用户相关数据列表

### 3.1.1绑定房屋列表

>说明:获得该用户绑定房屋的数据列表，以及该用户等待审核和审核未通过的数据

>请求方法：POST

>url地址：<https://tc.mg.cool/api/v1/user/housesList>

#### 3.1.1.1头部信息

> Authorization: Bearer token值

#### 3.1.1.2返回数据

字段|类型|是否必填|释义|选项
|:--|:--|:--|:--|:--
id|integer|选填|房屋绑定id|用于解绑时传递
house_id|integer|选填|房屋id|用来点击进入房屋详情页时使用的id号码
shenhe_id|string|选填|审核id|用来点击进入审核详情页时使用的id号码
status|string|必填|审核状态|默认房屋都是已通过审核，审核都是待审核或未通过审核（详见前言审核状态部分）
introduction|string|必填|对房屋的描述
action|string|选填|审核动作
role|integer|必填|居民在该房屋内的角色|直接返回角色汉字
not_register|integer|选填|未激活的家庭成员数目

#### 3.1.1.3结果示例

``` json
1.成功，返回列表数据
{
    "code": "0",
    "token_expired": "1",
    "msg": "成功获取用户一标三实列表",
    "data": [
        {
            "house_id": 1,
            "status": "审核通过",
            "role": "业主",
            "role_name":"业主",
            "introduction": "晨曦家园1栋1单元1楼101号",
            "not_register": 1
        },
        {
            "house_id": 2,
            "status": "审核通过",
            "role": "父亲",
            "role_name":"父亲",
            "introduction": "晨曦家园3栋2单元4楼401号",
            "not_register": 5
        },
        {
            "shenhe_id": 1,
            "status": "待审核",
            "introduction": "晨曦家园1栋1单元1楼101号的业主正在申请：家属绑定",
            "action":"业主正在申请：业主绑定"
        }
    ],
    "message": "成功获取用户一标三实列表"
}

```

```  json
2.失败，未登录用户或token值超过1小时过期（理论上不应该出现token值过期的返回，因为过期时，应该先由小程序判断超过1小时过期，调取“刷新token”的接口，再携带新的token值（如果超过14天更新期限，则只能使用“code值获取token接口”重置token状态），来调取其他接口的数据。但实际当中，可能会出现意外情况，如还未到1小时，但服务器端缓存意外丢失，导致token值失效。）
{
    "code": "9",
    "token_expired": "0",
    "msg": "请重新建立智慧平台鉴权连接",
    "message": "token值因各种原因而失效，请重新调用接口获取token"
}
```

---

### 3.1.2房屋详情页

>说明:该页面包含了房屋的已绑定人口、未绑定、已激活、未激活

>请求方法：POST

>url地址：<https://tc.mg.cool/api/v1/house/detail>

#### 3.1.2.1头部信息

> Authorization: Bearer token值

#### 3.1.2.2携带数据

字段|类型|是否必填|释义|选项
|:--|:--|:--|:--|:--
id|integer|必填|房屋id

#### 3.1.2.3返回数据

字段|类型|是否必填|释义|补充
|:--|:--|:--|:--|:--
introduction|string|必填|房屋地址|
house_type|string|必填|房屋类型|见前言[房屋类型](#house_type)
use|string|必填|房屋用途|见前言[房屋用途](#people_house_type)
xingzhi|string|必填|房屋性质|见前言[房屋性质](#people_house_xingzhi)
status|string|必填|房屋状态|见前言[房屋状态](#people_house_status)
zhuhuleixing|string|必填|住户类型|见前言[住户类型](#people_house_type)
data|array|必填|返回数据
message|string|必填|调试信息

- data
  
字段|类型|是否必填|释义|补充
|:--|:--|:--|:--|:--
yibangding|array|必填|已绑定的家庭成员
weibangding|array|必填|未绑定的家庭成员
yijihuo|array|必填|已激活的家庭成员
weijihuo|array|必填|未激活的家庭成员

#### 3.1.2.4结果示例

``` json
1.成功，返回列表数据
{
    "code": "0",
    "token_expired": "1",
    "msg": "成功获取房屋信息",
    "data": {
        "introduction": "晨曦家园1栋1单元1楼101号",
        "house_type": "单元楼",
        "use": "住宅",
        "xingzhi": "私有",
        "status": "自用",
        "zhuhuleixing": "业主",
        "yibangding": [
            {
                "shouquan": "管理员",
                "id": 2,
                "name": "付钰",
                "role": "业主"
            },
            {
                "shouquan": "邀请激活",
                "id": 1,
                "name": "付文生",
                "role": "父亲"
            },
            {
                "shouquan": "禁用管理",
                "id": 3,
                "name": "李四",
                "role": "妻子"
            },
            {
                "shouquan": "授权管理",
                "id": 4,
                "name": "付聪",
                "role": "儿子"
            }
        ],
        "weibangding": [
            {
                "id":8,
                "introduction": "晨曦家园1栋1单元1楼101号",
                "action":"租客正在申请：租客绑定",
                "status": "待审核",
                "type":"租客绑定"
            },
            {
                "id":4,
                "introduction": "晨曦家园1栋1单元1楼101号",
                "action":"家属正在申请：家属绑定",
                "status": "未通过",
                "type":"家属绑定"
            },
        ],
        "yijihuo": [
            {
                "shouquan": "管理员",
                "id": 2,
                "name": "付钰",
                "role": "业主"
            },
            {
                "shouquan": "禁用管理",
                "id": 3,
                "name": "李四",
                "role": "妻子"
            },
            {
                "shouquan": "授权管理",
                "id": 4,
                "name": "付聪",
                "role": "儿子"
            }
        ],
        "weijihuo": [
            {
                "shouquan": "邀请激活",
                "name": "付文生",
                "role": "父亲"
            }
        ]
    },
    "message": "成功获取房屋信息"
}
```

```  json
2.失败，未登录用户或token值超过1小时过期（理论上不应该出现token值过期的返回，因为过期时，应该先由小程序判断超过1小时过期，调取“刷新token”的接口，再携带新的token值（如果超过14天更新期限，则只能使用“code值获取token接口”重置token状态），来调取其他接口的数据。但实际当中，可能会出现意外情况，如还未到1小时，但服务器端缓存意外丢失，导致token值失效。）
{
    "code": "9",
    "token_expired": "0",
    "msg": "请重新建立智慧平台鉴权连接",
    "message": "token值因各种原因而失效，请重新调用接口获取token"
}
```

### 3.1.3审核详情页

>说明:返回审核录入的信息

>请求方法：POST

>url地址：<https://tc.mg.cool/api/v1/shenhe/detail>

#### 3.1.3.1头部信息

> Authorization: Bearer token值

#### 3.1.3.2携带数据

字段|类型|是否必填|释义|选项
|:--|:--|:--|:--|:--
id|integer|必填|审核id

#### 3.1.3.3返回数据

字段|类型|是否必填|释义|补充
|:--|:--|:--|:--|:--
shenhe_status|必填|审核状态|见前言[审核状态](#shenhe_status)
shenhe_action_introduction|string|必填|审核行为介绍|
shenhe_house_introduction|string|必填|审核房子介绍|
shenhe_refuse_reason|string|选填|拒绝原因|shenhe_status=0时显示
name|string|必填|姓名
sex|string|必填|男女
birth|string|必填|出生日期
nation|string|必填|民族
address|string|必填|户籍地址
idcard|string|必填|身份证
photo|string|必填|人脸照片
zhengzhimianmao|string|必填|政治面貌
tuiyijunren|integer|必填|是否退役军人
shangfang|integer|必填|是否上访
dibao|integer|必填|是否低保
job|string|必填|职业
company|string|必填|工作单位
use|string|选填|房屋用途|见前言[房屋用途](#people_house_type)
xingzhi|string|必填|房屋性质|见前言[房屋性质](#people_house_xingzhi)
house_status|string|必填|房屋状态|见前言[房屋状态](#people_house_status)
zhuhuleixing|string|必填|住户类型|见前言[住户类型](#people_house_type)
message|string|必填|调试信息

#### 3.1.3.4结果示例

``` json
1.成功，返回列表数据
{
    "code": "0",
    "token_expired": "1",
    "msg": "成功获取用户审核信息",
    "data":{
            "shenhe_type": "业主绑定",
            "shenhe_status": 1,
            "shenhe_action_introduction": "业主正在申请：业主绑定",
            "shenhe_house_introduction": "晨曦家园1栋1单元2楼201号",
            "shenhe_refuse_reason": "",
            "name": "杨哲",
            "sex": "男",
            "birth": "19921130",
            "nation": "汉族",
            "address": "河北秦皇岛海港区",
            "idcard": "130302199211302519",
            "photo": "www.....",
            "zhengzhimianmao": "1",
            "tuiyijunren": "0",
            "shangfang": "0",
            "dibao": "0",
            "job": "程序员",
            "company": "万家灯火",
            "house_role": "业主",
            "house_status": "自用",
            "use": "住宅",
            "xingzhi": "私有",
            "zhuhuleixing": "业主"
        },
    "message": "成功获取审核信息"
}
```

```  json
2.失败
{
    "code": "1",
    "token_expired": "0",
    "msg": "未查找到审核信息",
    "message": "未查找到审核信息。message编码Yi1815"
}
```

### 3.1.4删除审核

>说明:返回审核录入的信息

>请求方法：DELETE

>url地址：<https://tc.mg.cool/api/v1/shenhe/detail>

#### 3.1.4.1头部信息

> Authorization: Bearer token值

#### 3.1.4.2携带数据

字段|类型|是否必填|释义|选项
|:--|:--|:--|:--|:--
id|integer|必填|审核id

#### 3.1.4.3返回数据

字段|类型|是否必填|释义|补充
|:--|:--|:--|:--|:--
code|integer|必填|处理结果|
message|string|必填|调试信息

#### 3.1.4.4结果示例

``` json
1.成功，返回列表数据
{
    "code": "0",
    "token_expired": "1",
    "msg": "删除成功",
    "message": "删除成功"
}
```

```  json
2.失败
{
    "code": "1",
    "token_expired": "0",
    "msg": "删除失败",
    "message": "审核删除失败,message编程1879"
}
```

## 3.2用户授权

### 3.2.1业主授权/禁用家庭成员管理

>说明:决定家庭成员是否可以绑定其他人

>请求方法：PUT

>url地址：<https://tc.mg.cool/api/v1/house/shouquan>

#### 3.2.1.1头部信息

> Authorization: Bearer token值

#### 3.2.1.2携带数据

字段|类型|是否必填|释义|选项
|:--|:--|:--|:--|:--
id|integer|必填|人员房屋绑定id|用来制定修改谁的权限

#### 3.2.1.3返回数据

字段|类型|是否必填|释义|选项
|:--|:--|:--|:--|:--
data|string|必填|按钮应该显示的字样（因为是显示，所以与实际的权限是相反的）|禁止管理时，家庭成员显示“授权管理”;授权管理时，显示“禁止管理”

#### 3.2.1.4结果示例

``` json
1.成功，返回列表数据
{
    "code": 0,
    "token_expired": 1,
    "msg": "修改成功",
    "data": "授权管理",
    "message": "已经把该家庭成员的people_house_shouquan改为了0，0为禁止管理，1为授权管理"
}

```

### 3.2.2解绑

>说明:获得该用户绑定房屋的数据列表，以及该用户等待审核和审核未通过的数据

>请求方法：DELETE

>url地址：<https://tc.mg.cool/api/v1/house/shouquan>

#### 3.2.2.1头部信息

> Authorization: Bearer token值

#### 3.2.2.2携带数据

字段|类型|是否必填|释义|选项
|:--|:--|:--|:--|:--
id|integer|必填|人员房屋绑定id|用来解绑

#### 3.2.2.3返回数据

字段|格式|是否必填|名称|补充
|:--|:--|:--|:--|:--
code|integer|必填|处理结果|0成功，1出错
msg|string|必填|描述返回结果|
message|string|必填|调试信息|
token_expired|integer|必填|token值仍然未过期”

#### 3.2.2.4结果示例

``` json
1.成功，返回列表数据
{
    "code": 0,
    "token_expired": 1,
    "msg": "解绑成功",
    "message": "删除成功"
}

```

### 3.2.3业主授权/禁用家庭成员支付

>说明:决定家庭成员是否有权力支付和查看账单

>请求方法：PUT

>url地址：<https://tc.mg.cool/api/v1/house/charge>

#### 3.2.3.1头部信息

> Authorization: Bearer token值

#### 3.2.3.2携带数据

字段|类型|是否必填|释义|选项
|:--|:--|:--|:--|:--
id|integer|必填|人员房屋绑定id|用来制定修改谁的权限

#### 3.2.3.3返回数据

字段|类型|是否必填|释义|选项
|:--|:--|:--|:--|:--
data|string|必填|按钮应该显示的字样（因为是显示，所以与实际的权限是相反的）|禁止管理时，家庭成员显示“授权支付”;授权管理时，显示“禁止支付”

#### 3.2.3.4结果示例

``` json
1.成功，返回列表数据
{
    "code": 0,
    "token_expired": 1,
    "msg": "修改成功",
    "data": "授权支付",
    "message": "已经把该家庭成员的people_house_charge改为了0，0为禁止支付，1为授权支付"
}

```

---
---
---

# 4订单支付

## 4.1列表

### 4.1.1订单列表

>说明:获得该用户的所有订单

>请求方法：POST

>url地址：<https://tc.mg.cool/api/v1/orders/list>

#### 4.1.1.1头部信息

> Authorization: Bearer token值

#### 4.1.1.2携带数据

字段|类型|是否必填|释义|选项
|:--|:--|:--|:--|:--
paied|boolean|选填|订单状态0未支付1已支付|
title|string|选填|订单名称|如“物业费”（初始化时提供）
house_id|integer|选填|房屋id|只查看某房屋的订单
per_page|integer|选填|每页显示多少条
page|integer|选填|第几页的数据

#### 4.1.1.2返回数据

字段|类型|是否必返|释义|选项
|:--|:--|:--|:--|:--
code|integer|必返|返回状态|0成功1报错
msg|string|必返|返回信息|
message|string|必返|调试信息
data|array|必返|订单列表|
pages|object|必返|页码信息

- data

字段|类型|是否必返|释义|选项
|:--|:--|:--|:--|:--
id|integer|必返|订单id|调用支付接口时使用，多个订单id同时缴费时，使用ids = “1A2A3A4”的方式传递，详见[支付接口](#zhifujiekou)
manager|string|必返|收费来源|晨曦家园物业公司或者是晨曦家园
paied|boolean|必返|缴费状态|已付款/未付款
title|string|必返|订单名称
amount|float|必返|缴费金额|
status|string|必返|订单状态|进行中/已关闭
remark|string|否|订单备注
extra|json|否|订单明细

- pages

字段|名称|补充
|:--|:--|:--
current_page|当前页码|
from|本页开始是从第多少条记录为起点|
last_page|最后一页|
path|接口地址|
per_page|每页显示记录数量|
to|本页结束是从第多少条为终点|
total|总共有多少条记录

#### 4.1.1.3结果示例

``` json
1.成功，返回列表数据
{
    "code": 0,
    "token_expired": 1,
    "msg": "获取订单列表成功",
    "message": "获取订单列表成功",
    "data": [
        {
            "id": 21,
            "paied": "已付款",
            "number": "20201211163729119876",
            "title": "付钰费",
            "amount": "0.01元",
            "status": "进行中",
            "remark": "2020年的付钰费",
            "extra": "{'单价':'30元/平米'}",
            "manager": "晨曦家园物业有限公司"
        },
        {
            "id": 20,
            "paied": "已付款",
            "number": "20201210171754508115",
            "title": "物业费2020年12月10日17-18",
            "amount": "0.01元",
            "house": "晨曦家园1栋1单元1楼101号",
            "status": "进行中",
            "remark": null,
            "extra": null,
            "manager": "秦皇小区"
        },
    ],
    "pages": {
        "current_page": 1,
        "first_page_url": "https://tc.mg.cool/api/v1/orders/list?page=1",
        "from": 1,
        "last_page": 2,
        "last_page_url": "https://tc.mg.cool/api/v1/orders/list?page=2",
        "next_page_url": "https://tc.mg.cool/api/v1/orders/list?page=2",
        "path": "https://tc.mg.cool/api/v1/orders/list",
        "per_page": 15,
        "prev_page_url": null,
        "to": 15,
        "total": 17
    }
}

```

---
---
---

### 4.1.2账单列表

>说明:获得该用户的所有账单

>请求方法：POST

>url地址：<https://tc.mg.cool/api/v1/payments/list>

#### 4.1.2.1头部信息

> Authorization: Bearer token值

#### 4.1.2.2携带数据

字段|类型|是否必填|释义|选项
|:--|:--|:--|:--|:--
paied|boolean|选填|订单状态0已关闭1进行中|
title|string|选填|订单名称|如“物业费”（初始化时提供）
house_id|integer|选填|房屋id|只查看某房屋的订单
per_page|integer|选填|每页显示多少条
page|integer|选填|第几页的数据

#### 4.1.2.2返回数据

字段|类型|是否必返|释义|选项
|:--|:--|:--|:--|:--
code|integer|必返|返回状态|0成功1报错
msg|string|必返|返回信息|
message|string|必返|调试信息
data|array|必返|账单列表|
pages|object|必返|页码信息

- data

字段|类型|是否必返|释义|补充
|:--|:--|:--|:--|:--
id|integer|必返|账单id|
total_amount|float|必返|缴费总金额|
paid_at|string|必返|支付时间
payment_number|string|必返|微信支付流水号
payment_shop_number|string|必返|商户号

- orders

字段|类型|是否必返|释义|选项
|:--|:--|:--|:--|:--
id|integer|必返|订单id|调用支付接口时使用
paied|boolean|必返|缴费状态|已付款/未付款
title|string|必返|订单名称
amount|float|必返|缴费金额|
status|string|必返|订单状态|进行中/已关闭
remark|string|否|订单备注
extra|json|否|订单明细
house|string|否|收费房屋对象（对个人的收费不会出现）
manager|string|必返|收费来源主体|如“XXXX物业公司”


- pages

字段|名称|补充
|:--|:--|:--
current_page|当前页码|
from|本页开始是从第多少条记录为起点|
last_page|最后一页|
path|接口地址|
per_page|每页显示记录数量|
to|本页结束是从第多少条为终点|
total|总共有多少条记录

#### 4.1.2.3结果示例

``` json
1.成功，返回列表数据
{
    "code": 0,
    "token_expired": 1,
    "msg": "成功获取账单列表",
    "message": "成功获取账单列表Payments234",
    "data": [
        {
            "id": 1,
            "total_amount": "0.02",
            "paid_at": "2020-12-13 23:01:07",
            "payment_number": "4200000848202012131079162905",
            "payment_shop_number": "10002C2Y1A2Z5fd62cac34e925fd62ca",
            "orders": [
                {
                    "id": 1,
                    "number": "20201213225857334000",
                    "title": "测试费1",
                    "amount": "0.01元",
                    "house": "晨曦家园1栋1单元1楼101号",
                    "status": "进行中"
                },
                {
                    "id": 2,
                    "number": "20201213225900130758",
                    "title": "测试费2",
                    "amount": "0.01元",
                    "house": "晨曦家园1栋1单元1楼101号",
                    "status": "进行中"
                }
            ]
        }
    ],
    "pages": {
        "current_page": 1,
        "first_page_url": "https://tc.mg.cool/api/v1/orders/list?page=1",
        "from": 1,
        "last_page": 2,
        "last_page_url": "https://tc.mg.cool/api/v1/orders/list?page=2",
        "next_page_url": "https://tc.mg.cool/api/v1/orders/list?page=2",
        "path": "https://tc.mg.cool/api/v1/orders/list",
        "per_page": 15,
        "prev_page_url": null,
        "to": 15,
        "total": 17
    }
}

```

---
---
---


## 4.2支付

### 4.2.1支付接口

><span id="zhifujiekou">说明:用订单id来支付</span>

>请求方法：POST

>url地址：<https://tc.mg.cool/api/v1/weapp/payment>

#### 4.2.1.1头部信息

> Authorization: Bearer token值

#### 4.2.1.2携带数据

字段|类型|是否必填|释义|选项
|:--|:--|:--|:--|:--
ids|string|必填|使用“A”隔开的选中订单id的字符串|形式为“21A22A23A24”代表21号、22号、23号、24号订单一起缴费

#### 4.3.1.2返回数据

字段|类型|是否必返|释义|选项
|:--|:--|:--|:--|:--
code|integer|必返|返回状态|0成功1报错
msg|string|必返|返回信息|
message|string|必返|调试信息
data|array|必返|缴费信息|

#### 4.2.1.3结果示例

``` json
1.成功，返回缴费信息
{
    "code": 0,
    "token_expired": 1,
    "msg": "成功获取缴费信息",
    "data": {
        "appId": "wx3c3d7ceb2deb958d",
        "timeStamp": "1607678409",
        "nonceStr": "RvDkAXFUpscM1ksX",
        "package": "prepay_id=wx111720097829482df8a1fa234453380000",
        "signType": "MD5",
        "paySign": "CA2A8645235DC63430D71DA7043BD674"
    },
    "message": "成功获取缴费信息"
}

```

---
---
---
